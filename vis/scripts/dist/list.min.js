function myListView(){function e(){}function t(e){var t=d3.mouse(this),n=a(t),i=g(n[0]-Z,n[1]-Z,{d:200,p:null},w);if(J=i.d,i.p&&!de){var e=i.p,r=[(e.x+Z)*I+S[0],(M+e.y+Z)*I+S[1]];q.center(r),se=e}A.style("cursor",function(){return i.d<5&&se.active?"pointer":"default"})}function n(e,t){oe=!oe;var n=d3.nest().key(function(e){return e.jahr}).entries(e);n.forEach(function(e){var n=B(+e.key),a=e.values.length;e.values.forEach(function(e,i){var r=Math.floor(i/V)+2;e.x=n+i%V*(R/V),e.y=(t?1:-1)*(r*(R/V)),e.x1=e.x*z+K/2,e.y1=e.y*z+K/2,0==e.sprite.position.x&&(e.sprite.position.x=e.x1,e.sprite.position.y=e.y1),e.sprite2&&(e.sprite2.position.x=e.x*P+N/2,e.sprite2.position.y=e.y*P+N/2),e.order=1*(a-i)})})}function a(e){var t=[0,0];return t[0]=e[0]/I-S[0]/I,t[1]=e[1]/I-M-S[1]/I,t}function i(){L.forEach(function(e,t){var n;n=e.x1-e.sprite.position.x,Math.abs(n)>.1&&(e.sprite.position.x+=.1*n),n=e.y1-e.sprite.position.y,Math.abs(n)>.1&&(e.sprite.position.y+=.1*n),n=e.alpha-e.sprite.alpha,Math.abs(n)>.01&&(e.sprite.alpha+=.2*n),e.sprite.visible=e.sprite.alpha>.1,e.sprite2&&(n=e.alpha2-e.sprite2.alpha,Math.abs(n)>.01&&(e.sprite2.alpha+=.2*n),e.sprite2.visible=e.sprite2.alpha>.1)})}function r(e){requestAnimationFrame(r),x(),i(),D.render(H),W.update()}function o(e,t){q.center(null),y(e),d3.select(".tagcloud").classed("hide",!0);var n=B.rangeBand()/3/2,a=E/8,i=.6/(B.rangeBand()/3/E),r=[-i*(e.x-n)-a,-i*(M+e.y)];ce=i,setTimeout(function(){c(e)},t/2),F.call(q.translate(S).event).transition().duration(t).call(q.scale(i).translate(r).event).each("end",function(){de=!0,se=e,c(e),l(e),s(e)})}function l(e){logger.log({action:"zoomToDetail",target:e.id}),re.classed("hide",!1).select(".inner").html(ie(e));var t=re.select(".thementexte").text(e.thementexte.length?"":"Keine").selectAll("a").data(e.thementexte);t.enter().append("a"),t.exit().remove(),t.attr("href",function(e){return"thementexte/"+e.file}).attr("target","_blank").attr("title","zum PDF").text(function(e){return e.full_title})}function s(e,t){var n=new Image;n.addEventListener("load",function(){var t=new PIXI.BaseTexture(n),a=new PIXI.Texture(t),i=new PIXI.Sprite(a);i.anchor.x=.5,i.anchor.y=.5,i.position.x=e.x*X+U/2,i.position.y=e.y*X+U/2,i._data=e,e.big=!0,ae.addChild(i)}),n.crossOrigin="",n.src="https://s3.eu-central-1.amazonaws.com/fw4/large/"+e.id+".jpg"}function d(){for(;ae.children[0];)ae.children[0]._data.big=!1,ae.removeChild(ae.children[0])}function c(e){L.forEach(function(t){t.id!==e.id&&(t.alpha=0,t.alpha2=0)})}function u(){L.forEach(function(e){e.alpha=e.active?1:.2,e.alpha2=e.visible?1:0})}function p(e,t){j.forEach(function(t){t.pos=(B(t.key)-e)*I,t.visible=t.pos>-R*I&&t.pos<E+100}),O.attr("class","timeline "+fe(I)),O.style("font-size",function(){var e=2*I;return e+"px"});var n=O.selectAll(".container").data(j),a=n.enter().append("div").classed("container",!0);a.append("div").classed("year",!0).text(function(e){return e.key});var i=a.append("div").classed("entries",!0).selectAll(".entry").data(function(e){return e.values}).enter().append("div").classed("entry",!0);i.append("div").classed("small",!0).append("div").classed("title",!0).text(function(e){return e.titel});var r=i.append("div").classed("middle",!0);r.append("div").classed("title",!0).text(function(e){return e.titel}),r.append("div").classed("text",!0).text(function(e){return e.text+"."});var o=i.append("div").classed("large",!0);o.append("div").classed("title",!0).text(function(e){return e.titel}),o.append("div").classed("text",!0).html(function(e){return e.text+".<br><br>"+e.extra}),n.style("transform",function(e){return"translate("+e.pos+"px,0px)"}).style("height",R*I+"px").style("width",R*I+"px").style("display",function(e){return e.visible?"block":"none"}),n.select(".year").style("font-size",pe(I)+"px")}function f(){S=d3.event.translate,I=d3.event.scale;var e=-1*S[0]/I,t=e+C/I,n=(S[1]+M*I,-ye[1]-me),a=(n-M)*I+M;ye[0]-me;null!=d3.event.sourceEvent&&(0>e?S[0]=0:t>C&&(S[0]=-1*(C*I-C)),S[1]<a&&(S[1]=a),q.translate([S[0],S[1]]),e=-1*S[0]/I,t=e+E/I),0!=ce&&I>ce&&!de&&se&&"image"==se.type&&(de=!0,q.center(null),ce=I,c(se),l(se)),de&&ce-20>I&&(de=!1,u(),d(),re.classed("hide",!0).classed("sneak",!1)),p(e,t);var i=M*I- -1*S[1]-G*I;O.style("transform","translate(0px,"+i+"px)"),I>ue?d3.select(".tagcloud").classed("hide",!0):d3.select(".tagcloud").classed("hide",!1),ee.scale.x=d3.event.scale,ee.scale.y=d3.event.scale,ee.x=d3.event.translate[0],ee.y=d3.event.translate[1]}function h(e){ge=!0,he=S,ve=I}function v(e){Q=S!==he,ge=!1,m(),logger.log({action:"zoomend",translate:S,scale:I,target:se?se.id:""}),de&&!se.big&&.1>ve-I&&s(se)}function g(e,t,n,a){var i=a.x1,r=a.y1,o=a.x2,l=a.y2;if(a.visited=!0,e<i-n.d||e>o+n.d||t<r-n.d||t>l+n.d)return n;var s=a.point;if(s){s.scanned=!0;var d=s.x-e,c=s.y-t,u=Math.sqrt(d*d+c*c);u<n.d&&(n.d=u,n.p=s)}var p=a.nodes,f=2*e>i+o,h=2*t>r+l;return p[2*h+f]&&(n=g(e,t,n,p[2*h+f])),p[2*h+(1-f)]&&(n=g(e,t,n,p[2*h+(1-f)])),p[2*(1-h)+f]&&(n=g(e,t,n,p[2*(1-h)+f])),p[2*(1-h)+(1-f)]&&(n=g(e,t,n,p[2*(1-h)+(1-f)])),n}function m(){var e=I;if(!de){L.forEach(function(t,n){var a=t.sprite.position,i=a.x/z+S[0]/e,r=a.y/z+S[1]/e,o=5;i>-o&&E/e+o>i&&M/e+o>r+M&&r>-1*M-o?t.visible=!0:t.visible=!1});var t=L.filter(function(e){return e.visible});t.length<50?L.forEach(function(e){e.visible&&e.loaded&&e.active?e.alpha2=1:e.visible&&!e.loaded&&e.active?loadImagesCue.push(e):e.alpha2=0}):L.forEach(function(e){e.alpha2=0})}}function y(e){if(e.loaded)return void(e.alpha2=1);if(imagesMap2.get(e.id)){var t=new Image;t.addEventListener("load",function(){var n=new PIXI.BaseTexture(t),a=new PIXI.Texture(n),i=new PIXI.Sprite(a);i.anchor.x=.5,i.anchor.y=.5,i.position.x=e.x*P+N/2,i.position.y=e.y*P+N/2,i._data=e,ne.addChild(i),e.sprite2=i,e.alpha2=e.highlight}),e.loaded=!0,t.src="data:image/jpg;base64,"+imagesMap2.get(e.id).image}}function x(){if(!ge&&!de&&loadImagesCue.length){var e=loadImagesCue.pop();imagesMap2&&!e.loaded&&y(e)}}var I,w,b={top:20,right:50,bottom:30,left:50},k=400,E=window.innerWidth-b.left-b.right,C=window.innerWidth,M=window.innerHeight<k?k:window.innerHeight,z=1,P=1,X=1,S=[0,0],I=1,j=d3.range(1810,1857).map(function(e){return{key:e}}),B=d3.scale.ordinal().rangeBands([b.left,E+b.left],.2).domain(j.map(function(e){return e.key})),T=d3.geom.quadtree().x(function(e){return e.x}).y(function(e){return e.y}),q=d3.behavior.zoom().scaleExtent([1,450]).on("zoom",f).on("zoomend",v).on("zoomstart",h);d3.select("body");var A,L,D,H,W,F,O,Z,R=0,G=0,K=100,N=1e3,U=4e3,V=3,J=0,Q=!1;_.templateSettings.interpolate=/{{([\s\S]+?)}}/g;var Y,$,H,ee,te,ne,ae,ie=_.template(d3.select("#detailTemplate").html()),re=d3.select(".sidebar").on("mouseenter",function(e){logger.log({action:"enter",scale:I,target:"detail"})}).on("mouseleave",function(e){logger.log({action:"exit",scale:I,target:"detail"})});e.loadTimeline=function(e){e.forEach(function(e){e.jahr=e.jahr.split("-")[0],e.jahr=1*e.jahr}),$=e,$.forEach(function(e){0==j.filter(function(t){return t.key==e.jahr}).length&&j.push({key:e.jahr})}),j.sort(function(e,t){return e.key-t.key}),B.domain(j.map(function(e){return e.key})),j.forEach(function(e){e.type="timeline",e.values=$.filter(function(t){return t.jahr==e.key}),e.id=e.key})},e.resize=function(){E=window.innerWidth-b.left-b.right,M=window.innerHeight<k?k:window.innerHeight,D.resize(E+b.left+b.right,M),e.makeScales(),e.flip()},e.makeScales=function(){B.rangeBands([b.left,E+b.left],.2),R=B.rangeBand(),G=B.rangeBand()/3,Z=R/V/2,z=K/(B.rangeBand()/V),P=N/(B.rangeBand()/V),X=U/(B.rangeBand()/V),te.scale.x=1/z,te.scale.y=1/z,te.y=M,ne.scale.x=1/P,ne.scale.y=1/P,ne.y=M,ae.scale.x=1/X,ae.scale.y=1/X,ae.y=M},e.init=function(n){L=n,A=d3.select(".page").append("div").classed("viz",!0),PIXI.SCALE_MODES.DEFAULT=PIXI.SCALE_MODES.NEAREST;var a={transparent:!1,resolution:1,antialiasing:!1};D=new PIXI.WebGLRenderer(E+b.left+b.right,M,a),window.renderer=D,D.backgroundColor=1842719;var i=d3.select(A.node().appendChild(D.view));W=new Stats,document.body.appendChild(W.domElement),H=new PIXI.Container,ee=new PIXI.Container,te=new PIXI.Container,ne=new PIXI.Container,ae=new PIXI.Container,H.addChild(ee),ee.addChild(te),ee.addChild(ne),ee.addChild(ae),L.forEach(function(e,t){var n=PIXI.Texture.fromImage("data:image/jpg;base64,"+imagesMap.get(e.id).image),a=new PIXI.Sprite(n);a.anchor.x=.5,a.anchor.y=.5,a._data=e,e.sprite=a,te.addChild(a)}),e.makeScales(),d3.select(".viz").call(q).on("mousemove",t).on("click",function(){(!se||se.id)&&(Q||J>15||(!se||se.active)&&(Math.abs(ce-I)<.1?(logger.log({action:"zoomback",scale:I,target:se?se.id:""}),e.resetZoom()):(logger.log({action:"zoomto",scale:I,target:se?se.id:""}),o(se,1400/Math.sqrt(Math.sqrt(I))))))}),F=i,O=d3.select(".viz").append("div").classed("timeline",!0).style("transform","translate(0px,"+(M-30)+"px)"),e.flip(),r()};var oe=!1;e.distance=function(e,t){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))},e.click=function(e){},e.mousemove=function(t){if(!cloud.lock){var n=d3.mouse(this),a=[t.point.x,t.point.y];e.distance(n,a)}},e.mouseover=function(e){if(!cloud.lock){var e=e.point;se=e;var t=[(e.x+R/3/2)*I+S[0],(M+e.y+R/3/2)*I+S[1]];q.center(t)}},e.mouseout=function(e){cloud.lock||(ue>I&&cloud.mouseleave(),Y.hide())},e.mousedown=function(e){if(!Q){var e=e.point;Q||o(e,1e3/Math.sqrt(Math.sqrt(I)))}};var le="";e.clearSearch=function(){le=""};var se=null,de=!1,ce=0,ue=2,pe=d3.scale.linear().domain([1,9]).range([9,20]).clamp(!0),fe=(d3.scale.linear().domain([2,8,20]).range([9,14,19]).clamp(!0),d3.scale.threshold().domain([3,10,20]).range(["none","small","middle","large"])),he=[0,0],ve=0,ge=!1;e.highlight=function(){L.forEach(function(e,t){e.alpha=e.highlight?1:.2})};var me=40,ye=[0,0];e.resetZoom=function(){var e=1400;ye=d3.extent(L,function(e){return e.y});var t=-ye[1]-me;F.call(q.translate(S).event).transition().duration(e).call(q.scale(1).translate([0,t]).event)},e.flip=function(){e.split(),e.resetZoom()},e.split=function(){var e=L.filter(function(e){return e.active});n(e,!1);var t=L.filter(function(e){return!e.active});n(t,!0),j.forEach(function(e){e.x=B(e.key)+R/3,e.y=5}),w=T(j.concat(L))},loadImagesCue=[];return e}
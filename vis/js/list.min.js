function myListView(){function e(){}function t(e){if(!ke){var t=d3.mouse(S.node()),n=a(t),i=v(n[0]-C,n[1]-C,{d:200,p:null},I);if(ee=i.d,ie&&i.p&&i.p.ii<3&&ee>7)xe=null,K.center(null),b.style("cursor","default");else{if(i.p&&!ye){var e=i.p,o=[(e.x+C)*w+Z[0],(N+e.y+C)*w+Z[1]];K.center(o),xe=e}b.style("cursor",function(){return i.d<5&&xe.active?"pointer":"default"})}}}function n(e,t){ve=!ve;var n=d3.nest().key(function(e){return e.jahr}).entries(e);n.forEach(function(e){var n=G(+e.key),a=e.values.length;e.values.sort(function(e,t){return t.keywords.length-e.keywords.length}),e.values.forEach(function(e,i){var o=Math.floor(i/$)+2;e.ii=i,e.x=n+i%$*(U/$),e.y=(t?1:-1)*(o*(U/$)),e.x1=e.x*A+J/2,e.y1=e.y*A+J/2,0==e.sprite.position.x&&(e.sprite.position.x=e.x1,e.sprite.position.y=e.y1),e.sprite2&&(e.sprite2.position.x=e.x*D+Q/2,e.sprite2.position.y=e.y*D+Q/2),e.order=1*(a-i)})})}function a(e){var t=[0,0];return t[0]=e[0]/w-Z[0]/w,t[1]=e[1]/w-N-Z[1]/w,t}function i(){E.forEach(function(e,t){var n;n=e.x1-e.sprite.position.x,Math.abs(n)>.1&&(e.sprite.position.x+=.1*n),n=e.y1-e.sprite.position.y,Math.abs(n)>.1&&(e.sprite.position.y+=.1*n),n=e.alpha-e.sprite.alpha,Math.abs(n)>.01&&(e.sprite.alpha+=.2*n),e.sprite.visible=e.sprite.alpha>.1,e.sprite2&&(n=e.alpha2-e.sprite2.alpha,Math.abs(n)>.01&&(e.sprite2.alpha+=.2*n),e.sprite2.visible=e.sprite2.alpha>.1)})}function o(e){requestAnimationFrame(o),y(),i(),k.render(M),z.update()}function r(e,t){re.zoomingToImage=!0,K.center(null),x(e),d3.select(".tagcloud").classed("hide",!0);var n=G.rangeBand()/3/2,a=q/8,i=.6/(G.rangeBand()/3/q),o=[-i*(e.x-n)-a,-i*(N+e.y)];we=i,setTimeout(function(){d(e)},t/2),T.call(K.translate(Z).event).transition().duration(t).call(K.scale(i).translate(o).event).each("end",function(){ye=!0,xe=e,d(e),l(e),s(e,"click"),re.zoomingToImage=!1})}function l(e){logger.log({action:"zoomToDetail",target:e.id}),de.select(".outer").node().scrollTop=0,de.classed("hide",!1).classed("sneak","en"==lang||utils.isMobile()).select(".inner").html(ce(e));var t=de.select(".thementexte").text(e.thementexte.length?"":"Keine").selectAll("a").data(e.thementexte);t.enter().append("a"),t.exit().remove(),t.attr("href",function(e){return("en"==lang?"../../vis/":"")+"thementexte/"+e.file}).attr("target","_blank").attr("title","zum PDF").text(function(e){return e.full_title})}function s(e,t){re.lastZoomed=e.id;var n="https://s3.eu-central-1.amazonaws.com/fw4/large/"+e.id+".jpg";LoaderBlob(n).finished(function(t){var n=new Image;n.addEventListener("load",function(){var t=new PIXI.BaseTexture(n),a=new PIXI.Texture(t),i=new PIXI.Sprite(a);i.scale.x=e.scaleFactor,i.scale.y=e.scaleFactor,i.anchor.x=.5,i.anchor.y=.5,i.position.x=e.x*L+Y/2,i.position.y=e.y*L+Y/2,i._data=e,e.big=!0,ge.addChild(i)}),n.src=t})}function c(){for(;ge.children[0];)ge.children[0]._data.big=!1,ge.removeChild(ge.children[0])}function d(e){E.forEach(function(t){t.id!==e.id&&(t.alpha=0,t.alpha2=0)})}function u(){E.forEach(function(e){e.alpha=e.active?1:.2,e.alpha2=e.visible?1:0})}function p(e,t){W.forEach(function(t){t.pos=(t.x-e)*w,t.visible=t.pos>-U*w&&t.pos<q+100}),P.attr("class","timeline "+Ee(w)),P.style("font-size",function(){return 2*w+"px"});var n=P.selectAll(".container").data(W),a=n.enter().append("div").classed("container",!0).on("mouseenter",function(e){ke=!0,K.center(null),xe=null,logger.log({action:"enter timeline",scale:w,translate:Z,target:e.key})}).on("mouseleave",function(e){ke=!1,logger.log({action:"exit timeline",scale:w,translate:Z,target:e.key})});a.append("div").classed("year",!0).text(function(e){return e.key});var i=a.append("div").classed("entries",!0).selectAll(".entry").data(function(e){return e.values}).enter().append("div").classed("entry",!0);i.append("div").classed("small",!0).append("div").classed("title",!0).text(function(e){return e.titel});var o=i.append("div").classed("middle",!0);o.append("div").classed("title",!0).text(function(e){return e.titel}),o.append("div").classed("text",!0).text(function(e){return e.text+"."});var r=i.append("div").classed("large",!0);r.append("div").classed("title",!0).text(function(e){return e.titel}),r.append("div").classed("text",!0).html(function(e){return e.text+".<br><br>"+e.extra}),n.style("transform",function(e){return"translate("+e.pos+"px,0px)"}).style("height",U*w+"px").style("width",U*w+"px").style("display",function(e){return e.visible?"block":"none"}),n.select(".year").style("font-size",be(w)+"px")}function f(){Z=d3.event.translate,w=d3.event.scale;var e=-1*Z[0]/w,t=e+F/w,n=(Z[1]+N*w,-ae[1]-ne),a=(n-N)*w+N;ae[0]-ne;if(null!=d3.event.sourceEvent&&(0>e?Z[0]=0:t>F&&(Z[0]=-1*(F*w-F)),Z[1]<a&&(Z[1]=a),K.translate([Z[0],Z[1]]),e=-1*Z[0]/w,t=e+q/w),0!=we&&w>we&&!ye&&xe&&"image"==xe.type&&(ye=!0,K.center(null),we=w,d(xe),l(xe)),ye&&we-20>w&&(ye=!1,re.lastZoomed=0,u(),c(),de.classed("hide",!0).classed("sneak","en"==lang)),"time"==re.mode){p(e,t);var i=N*w- -1*Z[1]-V*w;P.style("transform","translate(0px,"+i+"px)")}w>Ie?d3.select(".tagcloud").classed("hide",!0):d3.select(".tagcloud").classed("hide",!1),pe.scale.x=d3.event.scale,pe.scale.y=d3.event.scale,pe.x=d3.event.translate[0],pe.y=d3.event.translate[1]}function h(e){Te=!0,Me=Z,ze=w}function g(e){te=Z!==Me,Te=!1,m(),logger.log({action:"zoomend",translate:Z,scale:w,target:xe?xe.id:""}),!ye||xe.big||re.lastZoomed==xe.id||re.zoomingToImage||s(xe,"zoom")}function v(e,t,n,a){var i=a.x1,o=a.y1,r=a.x2,l=a.y2;if(a.visited=!0,e<i-n.d||e>r+n.d||t<o-n.d||t>l+n.d)return n;var s=a.point;if(s){s.scanned=!0;var c=s.x-e,d=s.y-t,u=Math.sqrt(c*c+d*d);u<n.d&&(n.d=u,n.p=s)}var p=a.nodes,f=2*e>i+r,h=2*t>o+l;return p[2*h+f]&&(n=v(e,t,n,p[2*h+f])),p[2*h+(1-f)]&&(n=v(e,t,n,p[2*h+(1-f)])),p[2*(1-h)+f]&&(n=v(e,t,n,p[2*(1-h)+f])),p[2*(1-h)+(1-f)]&&(n=v(e,t,n,p[2*(1-h)+(1-f)])),n}function m(){var e=w;if(!ye){E.forEach(function(t,n){var a=t.sprite.position,i=a.x/A+Z[0]/e,o=a.y/A+Z[1]/e,r=5;i>-r&&q/e+r>i&&N/e+r>o+N&&o>-1*N-r?t.visible=!0:t.visible=!1});var t=E.filter(function(e){return e.visible});t.length<50?E.forEach(function(e){e.visible&&e.loaded&&e.active?e.alpha2=1:e.visible&&!e.loaded&&e.active?H.push(e):e.alpha2=0}):E.forEach(function(e){e.alpha2=0})}}function x(e){if(e.loaded)return void(e.alpha2=1);if(imagesMap2.get(e.id)){var t=new Image;t.addEventListener("load",function(){var n=new PIXI.BaseTexture(t),a=new PIXI.Texture(n),i=new PIXI.Sprite(a);i.scale.x=e.scaleFactor,i.scale.y=e.scaleFactor,i.anchor.x=.5,i.anchor.y=.5,i.position.x=e.x*D+Q/2,i.position.y=e.y*D+Q/2,i._data=e,he.addChild(i),e.sprite2=i,e.alpha2=e.highlight}),e.loaded=!0,t.src="data:image/jpg;base64,"+imagesMap2.get(e.id).image}}function y(){if(!Te&&!ye&&H.length){var e=H.pop();imagesMap2&&!e.loaded&&x(e)}}var w,I,b,E,k,M,z,T,P,C,S,j,X={top:20,right:50,bottom:30,left:50},B=400,q=window.innerWidth-X.left-X.right,F=window.innerWidth,N=window.innerHeight<B?B:window.innerHeight,A=1,D=1,L=1,Z=[0,0],w=1,W=[],H=[],G=d3.scale.ordinal().rangeBands([X.left,q+X.left],.2),O=d3.geom.quadtree().x(function(e){return e.x}).y(function(e){return e.y}),R=utils.isMobile()?5e3:2500,K=d3.behavior.zoom().scaleExtent([1,R]).size([q,N]).on("zoom",f).on("zoomend",g).on("zoomstart",h),U=0,V=0,J=100,Q=1e3,Y=4e3,$=3,ee=0,te=!1,ne=50,ae=[0,0],ie=!0,oe=0,re={lastZoomed:0,zoomingToImage:!1,mode:"time",last:{mode:"time"}},le=!1,se=d3.layout.force().size([q,N]),ce=_.template(d3.select("#detailTemplate").html()),de=d3.select(".sidebar").on("mouseenter",function(e){logger.log({action:"enter",scale:w,target:"detail"})}).on("mouseleave",function(e){logger.log({action:"exit",scale:w,target:"detail"})});d3.select(".infobar").on("mouseenter",function(e){logger.log({action:"enter",scale:w,target:"infobar"})}).on("mouseleave",function(e){logger.log({action:"exit",scale:w,target:"infobar"})});var ue,M,pe,fe,he,ge;e.setMode=function(t){P.classed("hide",function(e){return"time"!=t}),re.last.mode=re.mode,re.mode=t,e.project()},e.setTsneGrid=function(t){le=t,e.initTSNE()},e.resize=function(){q=window.innerWidth-X.left-X.right,N=window.innerHeight<B?B:window.innerHeight,F=window.innerWidth,k.resize(q+X.left+X.right,N),e.makeScales(),e.project()},e.makeScales=function(){G.rangeBands([X.left,q+X.left],.2),U=G.rangeBand(),V=G.rangeBand()/3,C=U/$/2,A=J/(G.rangeBand()/$),D=Q/(G.rangeBand()/$),L=Y/(G.rangeBand()/$),fe.scale.x=1/A,fe.scale.y=1/A,fe.y=N,he.scale.x=1/D,he.scale.y=1/D,he.y=N,ge.scale.x=1/L,ge.scale.y=1/L,ge.y=N,W.forEach(function(e){e.x=G(e.key)})},e.init=function(n,a,i){E=n,j=i,b=d3.select(".page").append("div").classed("viz",!0),PIXI.SCALE_MODES.DEFAULT=PIXI.SCALE_MODES.NEAREST;var l={transparent:!1,resolution:1,antialiasing:!1};k=new PIXI.WebGLRenderer(q+X.left+X.right,N,l),k.backgroundColor=1842719,window.renderer=k;var s=d3.select(b.node().appendChild(k.view));z=new Stats,document.body.appendChild(z.domElement),M=new PIXI.Container,pe=new PIXI.Container,fe=new PIXI.Container,he=new PIXI.Container,ge=new PIXI.Container,M.addChild(pe),pe.addChild(fe),pe.addChild(he),pe.addChild(ge),E.forEach(function(e,t){var n=PIXI.Texture.fromImage("data:image/jpg;base64,"+imagesMap.get(e.id).image),a=new PIXI.Sprite(n);a.anchor.x=.5,a.anchor.y=.5,a.scale.x=e.scaleFactor,a.scale.y=e.scaleFactor,a._data=e,e.sprite=a,fe.addChild(a)}),a.forEach(function(e){e.jahr=e.jahr.split("-")[0],e.jahr=1*e.jahr,e.type="timeline","en"==lang&&(e.titel=e.titelEN,e.text=e.textEN,e.extra=e.extraEN)});var c=d3.nest().key(function(e){return e.jahr}).entries(n.concat(a)).sort(function(e,t){return e.key-t.key}).map(function(e){return 1*e.key});W=c.map(function(e){return{key:e,values:a.filter(function(t){return e==t.jahr})}}),G.domain(c),e.makeScales(),S=d3.select(".viz").call(K).on("mousemove",t).on("dblclick.zoom",null).on("touchstart",function(e){t(e),oe=1*new Date}).on("touchend",function(e){var t=1*new Date-oe;t>250||ee>15||(!xe||xe.id)&&(!xe||xe.active)&&(te||r(xe,1400/Math.sqrt(Math.sqrt(w))))}).on("click",function(){(!xe||xe.id)&&(te||ee>15||(!xe||xe.active)&&(ke||(Math.abs(we-w)<.1?(logger.log({action:"zoomback",scale:w,target:xe?xe.id:""}),e.resetZoom()):(logger.log({action:"zoomto",scale:w,target:xe?xe.id:""}),r(xe,1400/Math.sqrt(Math.sqrt(w)))))))}),T=s,P=d3.select(".viz").append("div").classed("timeline",!0).style("transform","translate(0px,"+(N-30)+"px)"),e.project(),o()};var ve=!1;e.distance=function(e,t){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))},e.click=function(e){},e.mousemove=function(t){if(!cloud.lock){var n=d3.mouse(this),a=[t.point.x,t.point.y];e.distance(n,a)}},e.mouseout=function(e){cloud.lock||(Ie>w&&cloud.mouseleave(),ue.hide())},e.mousedown=function(e){if(!te){var e=e.point;te||r(e,1e3/Math.sqrt(Math.sqrt(w)))}};var me="";e.clearSearch=function(){me=""};var xe=null,ye=!1,we=117,Ie=2,be=d3.scale.linear().domain([1,9]).range([9,20]).clamp(!0),Ee=(d3.scale.linear().domain([2,8,20]).range([9,14,19]).clamp(!0),d3.scale.threshold().domain([3,10,20]).range(["none","small","middle","large"])),ke=!1,Me=[0,0],ze=0,Te=!1;d3.scale.threshold().domain([1.1,115,116]).range(["far","middle","close","detail"]);return e.highlight=function(){E.forEach(function(e,t){e.alpha=e.highlight?1:.2})},e.project=function(){"tsne"==re.mode||"grid"==re.mode?e.projectTSNE():e.split(),e.resetZoom()},e.projectTSNE=function(){var e=-N/2.5,t=E.filter(function(e){return!e.active}),n=t.length,a=E.filter(function(e){return e.active});t.sort(function(e,t){return e.rTSNE-t.rTSNE}),t.forEach(function(t,a){var i=300+100*t.scaleFactor,o=-Math.PI/2+a/n*2*Math.PI;t.x=i*Math.cos(o)+q/2,t.y=i*Math.sin(o)+e}),a.forEach(function(t){if("tsne"==re.mode){var n=10;t.x=t.tsne[0]*n+q/2,t.y=t.tsne[1]*n+e}else{var n=8;t.x=t.grid[0]*n+q/2-150,t.y=t.grid[1]*n-150+e}}),E.forEach(function(e){e.x1=e.x*A+J/2,e.y1=e.y*A+J/2,0==e.sprite.position.x&&(e.sprite.position.x=e.x1,e.sprite.position.y=e.y1),e.sprite2&&(e.sprite2.position.x=e.x*D+Q/2,e.sprite2.position.y=e.y*D+Q/2)}),I=O(E)},e.initGraph=function(){console.log(E),console.log(j),se.nodes(E).links(j).charge(-2).gravity(.01).linkDistance(10).on("tick",e.tick).start(),I=O(E),e.resetZoom()},e.tick=function(){console.log("tick"),E.forEach(function(e){e.x1=e.x*A+J/2,e.y1=e.y*A+J/2,0==e.sprite.position.x&&(e.sprite.position.x=e.x1,e.sprite.position.y=e.y1),e.sprite2&&(e.sprite2.position.x=e.x*D+Q/2,e.sprite2.position.y=e.y*D+Q/2)})},e.resetZoom=function(){var e=1400,t=1;ae=d3.extent(E,function(e){return e.y});var n;"time"==re.mode?(n=-ae[1]-ne,ie=-30>n&&n>-40):(n=-ne,ie=!1,ae[1]=-n,t=2),T.call(K.translate(Z).event).transition().duration(e).call(K.translate([0,n]).scale(1).event)},e.split=function(){var e=E.filter(function(e){return e.active});n(e,!1);var t=E.filter(function(e){return!e.active});n(t,!0),I=O(E)},e}
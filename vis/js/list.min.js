function myListView(){function e(){}function t(e){if(!me){var t=d3.mouse(this),n=a(t),i=v(n[0]-X,n[1]-X,{d:200,p:null},b)
if(Q=i.d,te&&i.p&&i.p.y>-16)ue=null,Z.center(null),I.style("cursor","default")
else{if(i.p&&!pe){var e=i.p,r=[(e.x+X)*w+H[0],(q+e.y+X)*w+H[1]]
Z.center(r),ue=e}I.style("cursor",function(){return i.d<5&&ue.active?"pointer":"default"})}}}function n(e,t){ce=!ce
var n=d3.nest().key(function(e){return e.jahr}).entries(e)
n.forEach(function(e){var n=F(+e.key),a=e.values.length
e.values.forEach(function(e,i){var r=Math.floor(i/J)+2
e.x=n+i%J*(R/J),e.y=(t?1:-1)*(r*(R/J)),e.x1=e.x*A+K/2,e.y1=e.y*A+K/2,0==e.sprite.position.x&&(e.sprite.position.x=e.x1,e.sprite.position.y=e.y1),e.sprite2&&(e.sprite2.position.x=e.x*L+U/2,e.sprite2.position.y=e.y*L+U/2),e.order=1*(a-i)})})}function a(e){var t=[0,0]
return t[0]=e[0]/w-H[0]/w,t[1]=e[1]/w-q-H[1]/w,t}function i(){E.forEach(function(e,t){var n
n=e.x1-e.sprite.position.x,Math.abs(n)>.1&&(e.sprite.position.x+=.1*n),n=e.y1-e.sprite.position.y,Math.abs(n)>.1&&(e.sprite.position.y+=.1*n),n=e.alpha-e.sprite.alpha,Math.abs(n)>.01&&(e.sprite.alpha+=.2*n),e.sprite.visible=e.sprite.alpha>.1,e.sprite2&&(n=e.alpha2-e.sprite2.alpha,Math.abs(n)>.01&&(e.sprite2.alpha+=.2*n),e.sprite2.visible=e.sprite2.alpha>.1)})}function r(e){requestAnimationFrame(r),y(),i(),k.render(z),C.update()}function o(e,t){Z.center(null),x(e),d3.select(".tagcloud").classed("hide",!0)
var n=F.rangeBand()/3/2,a=T/8,i=.6/(F.rangeBand()/3/T),r=[-i*(e.x-n)-a,-i*(q+e.y)]
fe=i,setTimeout(function(){d(e)},t/2),M.call(Z.translate(H).event).transition().duration(t).call(Z.scale(i).translate(r).event).each("end",function(){pe=!0,ue=e,d(e),l(e),s(e)})}function l(e){logger.log({action:"zoomToDetail",target:e.id}),ae.select(".outer").node().scrollTop=0,ae.classed("hide",!1).classed("sneak","en"==lang).select(".inner").html(ne(e))
var t=ae.select(".thementexte").text(e.thementexte.length?"":"Keine").selectAll("a").data(e.thementexte)
t.enter().append("a"),t.exit().remove(),t.attr("href",function(e){return("en"==lang?"../../vis/":"")+"thementexte/"+e.file}).attr("target","_blank").attr("title","zum PDF").text(function(e){return e.full_title})}function s(e,t){var n=new Image
n.addEventListener("load",function(){var t=new PIXI.BaseTexture(n),a=new PIXI.Texture(t),i=new PIXI.Sprite(a)
i.anchor.x=.5,i.anchor.y=.5,i.position.x=e.x*D+V/2,i.position.y=e.y*D+V/2,i._data=e,e.big=!0,se.addChild(i)}),n.crossOrigin="",n.src="https://s3.eu-central-1.amazonaws.com/fw4/large/"+e.id+".jpg"}function c(){for(;se.children[0];)se.children[0]._data.big=!1,se.removeChild(se.children[0])}function d(e){E.forEach(function(t){t.id!==e.id&&(t.alpha=0,t.alpha2=0)})}function u(){E.forEach(function(e){e.alpha=e.active?1:.2,e.alpha2=e.visible?1:0})}function p(e,t){N.forEach(function(t){t.pos=(t.x-e)*w,t.visible=t.pos>-R*w&&t.pos<T+100}),P.attr("class","timeline "+ve(w)),P.style("font-size",function(){return 2*w+"px"})
var n=P.selectAll(".container").data(N),a=n.enter().append("div").classed("container",!0).on("mouseenter",function(e){me=!0,Z.center(null),ue=null,logger.log({action:"enter timeline",scale:w,translate:H,target:e.key})}).on("mouseleave",function(e){me=!1,logger.log({action:"exit timeline",scale:w,translate:H,target:e.key})})
a.append("div").classed("year",!0).text(function(e){return e.key})
var i=a.append("div").classed("entries",!0).selectAll(".entry").data(function(e){return e.values}).enter().append("div").classed("entry",!0)
i.append("div").classed("small",!0).append("div").classed("title",!0).text(function(e){return e.titel})
var r=i.append("div").classed("middle",!0)
r.append("div").classed("title",!0).text(function(e){return e.titel}),r.append("div").classed("text",!0).text(function(e){return e.text+"."})
var o=i.append("div").classed("large",!0)
o.append("div").classed("title",!0).text(function(e){return e.titel}),o.append("div").classed("text",!0).html(function(e){return e.text+".<br><br>"+e.extra}),n.style("transform",function(e){return"translate("+e.pos+"px,0px)"}).style("height",R*w+"px").style("width",R*w+"px").style("display",function(e){return e.visible?"block":"none"}),n.select(".year").style("font-size",ge(w)+"px")}function f(){H=d3.event.translate,w=d3.event.scale
var e=-1*H[0]/w,t=e+j/w,n=(H[1]+q*w,-ee[1]-$),a=(n-q)*w+q
ee[0]-$
null!=d3.event.sourceEvent&&(0>e?H[0]=0:t>j&&(H[0]=-1*(j*w-j)),H[1]<a&&(H[1]=a),Z.translate([H[0],H[1]]),e=-1*H[0]/w,t=e+T/w),0!=fe&&w>fe&&!pe&&ue&&"image"==ue.type&&(pe=!0,Z.center(null),fe=w,d(ue),l(ue)),pe&&fe-20>w&&(pe=!1,u(),c(),ae.classed("hide",!0).classed("sneak","en"==lang)),p(e,t)
var i=q*w- -1*H[1]-G*w
P.style("transform","translate(0px,"+i+"px)"),w>he?d3.select(".tagcloud").classed("hide",!0):d3.select(".tagcloud").classed("hide",!1),re.scale.x=d3.event.scale,re.scale.y=d3.event.scale,re.x=d3.event.translate[0],re.y=d3.event.translate[1]}function h(e){we=!0,xe=H,ye=w}function g(e){Y=H!==xe,we=!1,m(),logger.log({action:"zoomend",translate:H,scale:w,target:ue?ue.id:""}),pe&&!ue.big&&.1>ye-w&&s(ue)}function v(e,t,n,a){var i=a.x1,r=a.y1,o=a.x2,l=a.y2
if(a.visited=!0,e<i-n.d||e>o+n.d||t<r-n.d||t>l+n.d)return n
var s=a.point
if(s){s.scanned=!0
var c=s.x-e,d=s.y-t,u=Math.sqrt(c*c+d*d)
u<n.d&&(n.d=u,n.p=s)}var p=a.nodes,f=2*e>i+o,h=2*t>r+l
return p[2*h+f]&&(n=v(e,t,n,p[2*h+f])),p[2*h+(1-f)]&&(n=v(e,t,n,p[2*h+(1-f)])),p[2*(1-h)+f]&&(n=v(e,t,n,p[2*(1-h)+f])),p[2*(1-h)+(1-f)]&&(n=v(e,t,n,p[2*(1-h)+(1-f)])),n}function m(){var e=w
if(!pe){E.forEach(function(t,n){var a=t.sprite.position,i=a.x/A+H[0]/e,r=a.y/A+H[1]/e,o=5
i>-o&&T/e+o>i&&q/e+o>r+q&&r>-1*q-o?t.visible=!0:t.visible=!1})
var t=E.filter(function(e){return e.visible})
t.length<50?E.forEach(function(e){e.visible&&e.loaded&&e.active?e.alpha2=1:e.visible&&!e.loaded&&e.active?W.push(e):e.alpha2=0}):E.forEach(function(e){e.alpha2=0})}}function x(e){if(e.loaded)return void(e.alpha2=1)
if(imagesMap2.get(e.id)){var t=new Image
t.addEventListener("load",function(){var n=new PIXI.BaseTexture(t),a=new PIXI.Texture(n),i=new PIXI.Sprite(a)
i.anchor.x=.5,i.anchor.y=.5,i.position.x=e.x*L+U/2,i.position.y=e.y*L+U/2,i._data=e,le.addChild(i),e.sprite2=i,e.alpha2=e.highlight}),e.loaded=!0,t.src="data:image/jpg;base64,"+imagesMap2.get(e.id).image}}function y(){if(!we&&!pe&&W.length){var e=W.pop()
imagesMap2&&!e.loaded&&x(e)}}var w,b,I,E,k,z,C,M,P,X,S={top:20,right:50,bottom:30,left:50},B=400,T=window.innerWidth-S.left-S.right,j=window.innerWidth,q=window.innerHeight<B?B:window.innerHeight,A=1,L=1,D=1,H=[0,0],w=1,N=[],W=[],F=d3.scale.ordinal().rangeBands([S.left,T+S.left],.2),O=d3.geom.quadtree().x(function(e){return e.x}).y(function(e){return e.y}),Z=d3.behavior.zoom().scaleExtent([1,450]).on("zoom",f).on("zoomend",g).on("zoomstart",h),R=0,G=0,K=100,U=1e3,V=4e3,J=3,Q=0,Y=!1,$=50,ee=[0,0],te=!0,ne=_.template(d3.select("#detailTemplate").html()),ae=d3.select(".sidebar").on("mouseenter",function(e){logger.log({action:"enter",scale:w,target:"detail"})}).on("mouseleave",function(e){logger.log({action:"exit",scale:w,target:"detail"})})
d3.select(".infobar").on("mouseenter",function(e){logger.log({action:"enter",scale:w,target:"infobar"})}).on("mouseleave",function(e){logger.log({action:"exit",scale:w,target:"infobar"})})
var ie,z,re,oe,le,se
e.resize=function(){T=window.innerWidth-S.left-S.right,q=window.innerHeight<B?B:window.innerHeight,k.resize(T+S.left+S.right,q),e.makeScales(),e.flip()},e.makeScales=function(){F.rangeBands([S.left,T+S.left],.2),R=F.rangeBand(),G=F.rangeBand()/3,X=R/J/2,A=K/(F.rangeBand()/J),L=U/(F.rangeBand()/J),D=V/(F.rangeBand()/J),oe.scale.x=1/A,oe.scale.y=1/A,oe.y=q,le.scale.x=1/L,le.scale.y=1/L,le.y=q,se.scale.x=1/D,se.scale.y=1/D,se.y=q,N.forEach(function(e){e.x=F(e.key)})},e.init=function(n,a){E=n,I=d3.select(".page").append("div").classed("viz",!0),PIXI.SCALE_MODES.DEFAULT=PIXI.SCALE_MODES.NEAREST
var i={transparent:!1,resolution:1,antialiasing:!1}
k=new PIXI.WebGLRenderer(T+S.left+S.right,q,i),k.backgroundColor=1842719,window.renderer=k
var l=d3.select(I.node().appendChild(k.view))
C=new Stats,document.body.appendChild(C.domElement),z=new PIXI.Container,re=new PIXI.Container,oe=new PIXI.Container,le=new PIXI.Container,se=new PIXI.Container,z.addChild(re),re.addChild(oe),re.addChild(le),re.addChild(se),E.forEach(function(e,t){var n=PIXI.Texture.fromImage("data:image/jpg;base64,"+imagesMap.get(e.id).image),a=new PIXI.Sprite(n)
a.anchor.x=.5,a.anchor.y=.5,a._data=e,e.sprite=a,oe.addChild(a)}),a.forEach(function(e){e.jahr=e.jahr.split("-")[0],e.jahr=1*e.jahr,e.type="timeline","en"==lang&&(e.titel=e.titelEN,e.text=e.textEN,e.extra=e.extraEN)})
var s=d3.nest().key(function(e){return e.jahr}).entries(n.concat(a)).sort(function(e,t){return e.key-t.key}).map(function(e){return 1*e.key})
N=s.map(function(e){return{key:e,values:a.filter(function(t){return e==t.jahr})}}),F.domain(s),e.makeScales(),d3.select(".viz").call(Z).on("mousemove",t).on("dblclick.zoom",null).on("click",function(){(!ue||ue.id)&&(Y||Q>15||(!ue||ue.active)&&(me||(Math.abs(fe-w)<.1?(logger.log({action:"zoomback",scale:w,target:ue?ue.id:""}),e.resetZoom()):(logger.log({action:"zoomto",scale:w,target:ue?ue.id:""}),o(ue,1400/Math.sqrt(Math.sqrt(w)))))))}),M=l,P=d3.select(".viz").append("div").classed("timeline",!0).style("transform","translate(0px,"+(q-30)+"px)"),e.flip(),r()}
var ce=!1
e.distance=function(e,t){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))},e.click=function(e){},e.mousemove=function(t){if(!cloud.lock){var n=d3.mouse(this),a=[t.point.x,t.point.y]
e.distance(n,a)}},e.mouseout=function(e){cloud.lock||(he>w&&cloud.mouseleave(),ie.hide())},e.mousedown=function(e){if(!Y){var e=e.point
Y||o(e,1e3/Math.sqrt(Math.sqrt(w)))}}
var de=""
e.clearSearch=function(){de=""}
var ue=null,pe=!1,fe=0,he=2,ge=d3.scale.linear().domain([1,9]).range([9,20]).clamp(!0),ve=(d3.scale.linear().domain([2,8,20]).range([9,14,19]).clamp(!0),d3.scale.threshold().domain([3,10,20]).range(["none","small","middle","large"])),me=!1,xe=[0,0],ye=0,we=!1
return e.highlight=function(){E.forEach(function(e,t){e.alpha=e.highlight?1:.2})},e.resetZoom=function(){var e=1400
ee=d3.extent(E,function(e){return e.y})
var t=-ee[1]-$
te=-30>t&&t>-40,M.call(Z.translate(H).event).transition().duration(e).call(Z.scale(1).translate([0,t]).event)},e.flip=function(){e.split(),e.resetZoom()},e.split=function(){var e=E.filter(function(e){return e.active})
n(e,!1)
var t=E.filter(function(e){return!e.active})
n(t,!0),b=O(E)},e}
function myTagCloud(){function t(){}function e(t){var e=1.8,n=1,r=0;t.forEach(function(t){t.x=r+u(t.values.length)*e+n,r+=u(t.values.length)*e})}function n(t){var e=_.last(t).x+100;return l/2-e/2}var r,i,o,a={top:10,right:20,bottom:20,left:10},l=window.innerWidth-a.left-a.right,c=400-a.top-a.bottom,u=d3.scale.linear(),s=d3.scale.linear(),f=[],d=d3.scale.ordinal().rangeBands([0,l]),g=d3.scale.linear().domain([1200,5e3]).range([50,200]),h=!1,p={init:!1},y=function(){};return t.init=function(e){o=e,r=d3.select(".page").append("div").style("width",l+a.left+a.right).style("height",c+a.top+a.bottom).classed("tagcloud",!0).append("div"),t.update()},t.resize=function(){p.init&&(l=window.innerWidth-a.left-a.right,c=400-a.top-a.bottom,r.style("width",l+a.left+a.right).style("height",c+a.top+a.bottom),d.rangeBands([0,l]),t.update())},t.filter=function(t,e){o.forEach(function(n){var r=t.filter(function(t){return n.keywords.indexOf(t)>-1});e?n.highlight=r.length==t.length:n.active=r.length==t.length});o.filter(function(t){return t.active}).length},t.update=function(){t.filter(f);var n=[];o.forEach(function(t){t.active&&t.keywords.forEach(function(e){n.push({keyword:e,data:t})})}),i=d3.nest().key(function(t){return t.keyword}).rollup(function(t){return t.map(function(t){return t.data})}).entries(n).sort(function(t,e){return e.values.length-t.values.length});var r=parseInt(g(l)),a=i.slice(0,r).sort(function(t,e){return d3.ascending(t.key[0],e.key[0])}),c=d3.extent(a,function(t){return t.values.length});u.domain(c).range([10,20]),c[0]==c[1]&&u.range([15,15]),s.domain(c).range([.2,1]),e(a),t.draw(a)},t.draw=function(e){var i=r.selectAll(".tag").data(e,function(t){return t.key});i.classed("active",function(t){return f.indexOf(t.key)>-1}).style("transform",function(t,e){return"translate("+t.x+"px,0px) rotate(45deg)"}).style("font-size",function(t){return u(t.values.length)+"px"}).style("opacity",1);var o=i.enter().append("div").classed("tag",!0).on("mouseenter",t.mouseenter).on("mouseleave",t.mouseleave).on("click",t.mouseclick).style("transform",function(t,e){return"translate("+t.x+"px,0px) rotate(45deg)"}).style("font-size",function(t){return u(t.values.length)+"px"}).style("opacity",0);o.append("span").text(function(t){return t.key}),o.append("div").classed("close",!0),o.transition().delay(400).duration(0).style("transform",function(t,e){return"translate("+t.x+"px,0px) rotate(45deg)"}).style("font-size",function(t){return u(t.values.length)+"px"}).style("opacity",1),i.exit().style("opacity",0).transition().duration(500).remove();var a=n(e);r.style("transform",function(t,e){return"translate("+a+"px,0px)"})},t.mouseclick=function(e){h=!0,f.indexOf(e.key)>-1?_.remove(f,function(t){return t==e.key}):f.push(e.key),t.update(),logger.log({action:"click",target:e.key}),t.highlightWords(f),setTimeout(function(){mouseclickCallback(e)},300),h=!1,list.clearSearch()},t.mouseleave=function(t){h||(logger.log({action:"exit",target:t.key}),r.selectAll(".tag").style("opacity",1),o.forEach(function(t){t.highlight=t.active}),y())},t.mouseenter=function(e){if(!h){logger.log({action:"enter",target:e.key});var n=_.clone(f);n.push(e.key),t.highlightWords(n)}},t.filterWords=function(e){t.filter(e,1),r.selectAll(".tag").style("opacity",function(t){return t.values.some(function(t){return t.active})?1:.2}),y()},t.highlightWords=function(e){t.filter(e,1),r.selectAll(".tag").style("opacity",function(t){return t.values.some(function(t){return t.highlight})?1:.2}),y()},t.search=function(e){""==e&&t.update(),d3.select(".search").text(e).classed("show",!0).transition().duration(1e3).each("end",function(){d3.select(this).classed("show",!1)}),console.log(e);var n=i.filter(function(t){return t.key.toUpperCase().indexOf(e)>-1}),r=d3.extent(n,function(t){return t.values.length});u.domain(r).range([10,20]),s.domain(r).range([.2,1]);var a=10,l=0;n.forEach(function(t){t.x=l,l+=u(t.values.length)+a}),t.draw(n);var c=n.map(function(t){return t.key});o.forEach(function(t){var e=c.filter(function(e){return t.keywords.indexOf(e)>-1});t.active=e.length>0}),list.highlight()},t.mouseenterCallback=function(t){y=t},t.mouseclickCallback=function(t){mouseclickCallback=t},t}